<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- Joint State Publisher -->
  <gazebo>
    <plugin filename="gz-sim-joint-state-publisher-system"
            name="gz::sim::systems::JointStatePublisher"/>
  </gazebo>

  <!-- Diff Drive -->
  <gazebo>
    <plugin filename="gz-sim-diff-drive-system"
            name="gz::sim::systems::DiffDrive">
      <left_joint>con_lf_wheel</left_joint>
      <right_joint>con_rf_wheel</right_joint>
      <wheel_separation>0.40</wheel_separation>
      <wheel_radius>0.112</wheel_radius>
      <topic>/cmd_vel</topic>
      <odom_topic>/odom</odom_topic>
      <frame_id>odom</frame_id>
      <child_frame_id>base_footprint</child_frame_id>
    </plugin>
  </gazebo>

  <!-- Arm Controllers -->
  <gazebo>
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>rev_lf_arm</joint_name>
      <topic>/drobot/arm_cmd</topic>
      <p_gain>50</p_gain><d_gain>5</d_gain>
    </plugin>
  </gazebo>

  <!-- Closed Loop: rear arms to side frames -->
  <gazebo>
    <joint name="left_rear_arm_loop" type="revolute">
      <parent>left_rear_arm</parent>
      <child>left_side_frame</child>
      <axis><xyz>1 0 0</xyz></axis>
    </joint>
  </gazebo>
  <gazebo>
    <joint name="right_rear_arm_loop" type="revolute">
      <parent>right_rear_arm</parent>
      <child>right_side_frame</child>
      <axis><xyz>1 0 0</xyz></axis>
    </joint>
  </gazebo>

  <!-- Wheel Friction -->
  <gazebo reference="left_front_wheel">
    <collision><surface>
      <friction><ode><mu>1.0</mu><mu2>0.5</mu2></ode></friction>
    </surface></collision>
  </gazebo>
  <gazebo reference="right_front_wheel">
    <collision><surface>
      <friction><ode><mu>1.0</mu><mu2>0.5</mu2></ode></friction>
    </surface></collision>
  </gazebo>
  <gazebo reference="left_rear_wheel">
    <collision><surface>
      <friction><ode><mu>1.0</mu><mu2>0.5</mu2></ode></friction>
    </surface></collision>
  </gazebo>
  <gazebo reference="right_rear_wheel">
    <collision><surface>
      <friction><ode><mu>1.0</mu><mu2>0.5</mu2></ode></friction>
    </surface></collision>
  </gazebo>

</robot>
